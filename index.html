<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.PNG">
<title>Mamu Trading Tagebuch</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
<style>
/*=================================================
BASIS (HTML / BODY)
=================================================== */

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    min-height: 100%;
    background-color: #000;
}

/* Scrollen NUR blockieren, wenn das Cover offen ist */
body.cover-open {
    height: 100dvh;
    overflow: hidden;
}

/* Scrollen ERLAUBEN, sobald die Page offen ist */
body.page-open {
    overflow-y: auto;
}

.buch-cover {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    /* dynamic viewport height füllt den Bereich inkl. Leisten aus */
    height: 100dvh; 
    
    /* Sorgt dafür, dass das Bild das Display füllt ohne zu verzerren */
    object-fit: cover; 
    
    /* Sicherheitsmaßnahme für ältere iOS Versionen */
    padding-bottom: env(safe-area-inset-bottom);
}



/*==================================================
  TYPOGRAFIE
  ================================================== */
/* h1 { margin:0 0 15px 0; font-size:36px; color:gold; text-align:center; text-shadow: 1px 1px 2px #b8860b; font-family:'Palatino Linotype','Book Antiqua', Palatino, serif; } */
.container h2 { margin:10px 0 5px; font-size:18px; color:#5b3a21; }

/*==================================================
  TABELLEN
  ================================================== */


.container table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 5px;
  table-layout: fixed;
  font-size: 14px;
  background: rgba(255,255,255,0.8);
  border-radius: 5px;
}

.container th,
.container td {
  border: 1px solid #aa845c;
  padding: 4px 6px;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.container th {
  background: #e6d9c1;
}

.container td.name-cell {
  text-align: left;
  padding-left: 6px;
}


.container table input[type=number],
.container table input[type=text] {
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  border: 1px solid #aa845c;
  border-radius: 4px;
  background: #ffffff;
  text-align: center;
  
}


 
 .cash-row {
  display: grid;
  grid-template-columns: auto 1fr 100px 160px;    /*  auto 1fr Breite Zahlenfeld position */
  align-items: center;
 }
 
 

/* Basis für alle Labels ( Cash und Gesamtwert)*/

.cash-label {
  height: 28px;
  line-height: 18px;
  padding: 0 12px;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  border: 1px solid #aa845c;
  border-radius: 6px;
  background: #e6d9c1;

  font-size: 14px;
  font-weight: 600;
  font-family: "Palatino Linotype", Palatino, serif;
  color: #5b3a21;

  width: 110px;      /* Standardbreite */
  flex-shrink: 0;   /* verhindert Mitziehen */
  white-space: nowrap;
}

/* kurze Variante: Cash */                 
.cash-label--short {
  width: 30px;
}

/* lange Variante: Gesamtwert */
.cash-label--long {
  width: 72px;
}
  
  .cash-button {
  cursor: pointer;
}

.cash-button:hover {
  filter: brightness(1.05);
}
  


.cash-display {

  height: 24px;                  /* NEU 28.01 28px */
  min-height: 24px;              /*     by    28px */
/*  line-height: 24px; */        /*    Mamu   24px */   

  grid-column: 3;
  justify-self: end;
  
  width: 100%;
  max-width: 100%;
  
  font-family: "Palatino Linotype", Palatino, serif;
  font-size: 16px;
  text-align: right;

  padding: 2px 10px;
  line-height: 1.0;               /* NEU 28.01   alter Wert 1.2  */
  
  color: #000;
  -webkit-text-fill-color: #000;   /* iOS fix */
  
  appearance: none;
  -webkit-appearance: none;

  background: #fffdf9;
  border: 1px solid #aa845c;
  border-radius: 6px;

  box-sizing: border-box;
  cursor: pointer;

  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum";
  
}

/* =========================
   Gesamtwert – Zahlenfeld
   ========================= */

.total-input {

  height: 24px;                  /* NEU 28.01 */
  min-height: 24px;              /*     by    */
/*  line-height: 24px;  */       /*    Mamu   */   

  grid-column: 3;
  justify-self: end;
 
  font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
  font-size: 16px;
  text-align: right;
  width: 100%;
  max-width: 100%;
  
  padding: 2px 10px;
  
  line-height: 1.0;

  background: #fffdf9;
  border: 1px solid #aa845c;
  border-radius: 6px;

  box-sizing: border-box;
 
 font-variant-numeric: tabular-nums;
 font-feature-settings: "tnum";
 
}


/* =========================
   Dezenter Textträger
   =========================     hinterlegt einen dezenten Farbbalken hinter Text zu Besseren Sichtbarkeit auf der Page    */
/*
.section-label {
  display: inline-block;
  padding: 2px 8px;

  background: rgba(255, 255, 255, 0.85);
  border-radius: 4px;

  font-size: 14px;
  font-weight: 600;
  color: #5b3a21;

  box-shadow: 0 0 0 1px rgba(170, 132, 92, 0.35);
  
  
}
*/


.section-label {
  display: inline;
  padding: 0px 4px;
  
  background: rgba(230, 217, 193, 0.55);

/*  background: rgba(255, 255, 255, 0.55);   */
  border-radius: 2px;

  color: #5b3a21;
  
  margin-top: 4px;         /* Abstand zum vorherigen Balken */
  margin-bottom: 4px;      /* Abstand nach Unten */
  
}



.edit-input {
 font-size: 16px;          /* verhindert iOS- Zoom */
 line-height: 1.2;
}


/*==================================================
  BUTTONS
  ================================================== */
  
#cover {
  position: fixed;
  inset: 0;

  width: 100%;
  height: 100dvh;
  min-height: 100%;

  background-image: url('cover.png');
  background-repeat: no-repeat;
  background-position: center center;
  background-size: cover;

  padding-bottom: env(safe-area-inset-bottom);

  cursor: pointer;
  z-index: 10;

  transition: transform 0.6s ease, opacity 0.6s ease;
}


#cover:hover {
  transform: scale(1.02);
}

/* .diff-bar margin-bottom Xpx stellt den Abstand zur nächsten Zeile/ Objekt      */

.diff-bar { height:26px; margin-top:5px; margin-bottom:8px; background: transparent; position:relative; border-radius:4px; overflow:hidden; }
.diff-fill { height:100%; position:absolute; left:0; top:0; border-radius:4px; text-align:center; color:white; font-size:14px; font-weight:bold; line-height:26px; transition: width 0.8s; }
.flex-item { margin-bottom:15px; }
.add-container, .update-container {
 width:100%;
 max-width: 310px;
 margin: 0 auto 10px;
 display:none;
 flex-direction:column;
 margin-bottom:10px;
 padding:8px;
 border-radius:5px;
 background:rgba(255,255,255,0.9);
}

.update-container { padding:10px; }



.update-row {
  display: flex;
  align-items: center;
  gap: 16px;              /* Abstand statt margin-left */
  margin: 4px 0;
}

.update-row label {
  flex: 0 0 50%;                /* Feld verschieben*/
  padding-left: 6px;
  font-weight: 600;
  color: #5b3a21;
}

.update-row input {
  width: 72px;            /* HIER steuerst du die Feldbreite */
  flex-shrink: 0;         /* nicht kleiner schrumpfen */
  text-align: center;
  border: 1px solid #aa845c;
  border-radius: 4px;
  background: #fff8f0;
}


/* 26.01. 21:30 Mamu
.update-row { display:flex; align-items:center; justify-content:flex-start; margin:4px 0; }
.update-row label { flex:0 0 45%; padding-left:6px; font-weight:bold; color:#5b3a21; }
.update-row input { flex:0 0 80px; margin-left:80px; text-align:center; border:1px solid #aa845c; border-radius:4px; background:#fff8f0; }
*/
.popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:1000; }
.popup-content { background:#fdf5e6; padding:20px; border-radius:5px; width:80%; max-width:300px; display:flex; flex-direction:column; gap:10px; }
.popup-content input { font-size:18px; text-align:center; border:1px solid #aa845c; border-radius:4px; background:#fff8f0; }
.popup-content button { font-size:16px; padding:6px; cursor:pointer; border-radius:5px; background:#b8860b; color:white; border:none; transition: background 0.3s ease; }
.popup-content button:hover { background:#a97500; }

.button-container { display:flex; gap:4%; justify-content:center; margin-top: 22px; margin-bottom:5px; }    /* margin-top: 20px neu eingefügt */

/* =========================
   Buttons – NEU & SAUBER
   ========================= */

.button-add {
  background: linear-gradient(
    180deg,
    #c06a3a,
    #a0522d
  );
  color: #fff;
  border: none;
  padding: 8px;
  font-size: 17px;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.35);
}

.button-add:hover {
  background: linear-gradient(
    180deg,
    #d57b48,
    #b35b34
  );
}

/*
.button-update {
  background: linear-gradient(
    180deg,
    #e0894c,
    #d2691e
  );
  color: #fff;
  border: none;
  padding: 8px;
  font-size: 17px;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.35);
}

.button-add:hover {
  background: linear-gradient(
    180deg,
    #f09a60,
    #e07b2a
  );
}
*/

.button-update {
  background: linear-gradient(
    180deg,
    #e2a76f,
    #cd853f
  );
  color: #fff;
  border: none;
  padding: 8px;
  font-size: 17px;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.35);
}

.button-update:hover {
  background: linear-gradient(
    180deg,
    #f0b982,
    #d89049
  );
}




.button-del {
  background: linear-gradient(180deg, #a83232, #6b1e1e);
  color: #fff;
  border: none;
  padding: 4px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
}

.button-del:hover {
  background: linear-gradient(180deg, #c04444, #822424);
}

#closeBook {
  position: absolute;
  top: 4px;
  right: 14px;

  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;

  background: rgba(230, 217, 193, 0.55); /* wie section-label */
  color: transparent;                   /* X unsichtbar */
  
  cursor: pointer;
  z-index: 50;

  box-shadow: none;
  transition: background 0.25s ease;
}

#closeBook:active {
  background: rgba(230, 217, 193, 0.8);
}





/* ======================================
   Seiten-Container (Page)
   ====================================== */
   .container {
  display: none;

  width: 100%;
  max-width: 420px;
  margin: 0 auto;

  background-image: url('page.png');
  background-repeat: repeat-y;
  background-size: 100% auto;
  background-position: top center;

  /* HIER passiert die Magie */
  padding-top: calc(env(safe-area-inset-top) + 0px);
  padding-bottom: calc(env(safe-area-inset-bottom) + 24px);
  padding-left: 16px;
  padding-right: 16px;

  box-sizing: border-box;

  height: auto;

  position: relative;
  z-index: 1;

  overflow-x: hidden;

  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.8s ease, transform 0.8s ease;
}
   
/* DAS HIER DANACH */
  .container.open {
  display: block;
  opacity: 1;
  transform: translateY(0);
  }



#closeBook:hover {
  background: rgba(150, 100, 50, 0.95);
  transform: scale(1.08);
}
/* Titel im Buch – exakt wie Cover */


.page-header {
  position: relative;     /* ehemals env(safe-area-inset-top); */
  padding-top: 16px;
}



.page-header h1 {
  margin-top: -19px;    /* vorher 0 ohne px */
  margin-bottom: 6px;  /* oder je nach Geschmack*/
  font-family: 'Cinzel Decorative', 'Palatino Linotype', serif;
  font-size: 28px;
  font-weight: 600;
  letter-spacing: 0.4px;

  text-align: center;

  color: #5b3a21;  /* edles Dunkelbraun */

  text-shadow:
    0 1px 1px rgba(255,255,255,0.2),
    0 2px 3px rgba(0,0,0,0.35);
}
  
  .container h2 {
  font-size: 18px;        /* vorher größer */
  font-weight: 600;      /* nicht bold */
  color: #5b3a21;        /* exakt Tabellenkopf-Farbe */
  margin: 8px 0 6px;
}

/*
.cash-input,
.total-input {
  font-size: 16px !important;
  text-align: right !important;
  }
*/
  
/*
  
@media (max-width: 480px) {
 
  .cash-row {
    grid-template-columns: auto 1fr 70px;
  }
}  
*/

</style>
</head>
<body>

<div id="cover"></div>

<div class="container">
<div class="page-header">
  <h1>Mamo Trading Tagebuch</h1>
  <button id="closeBook" aria-labeltitle="Buch schließen"></button>
</div>

<div class="button-container">
  <button class="button-add" onclick="toggleAdd()">Neues Wertpapier</button>
  <button class="button-update" onclick="toggleUpdate()">Kurse aktualisieren</button>
</div>

<div id="addContainer" class="add-container">


  <input type="text" id="newName" class="edit-input" placeholder="Name" style="text-align:left;">
  <input type="number" id="newAmount" class="edit-input" step="1" placeholder="Anzahl" style="text-align:left;">
  <input type="number" id="newPrice" class="edit-input" step="0.01" placeholder="Kurs (€)" style="text-align:left;">
  <div style="display:flex; gap:5px; margin-top:5px;">
    <label><input type="checkbox" id="addA" checked> Depot A</label>
    <label><input type="checkbox" id="addB" checked> Depot B</label>
    <label><input type="checkbox" id="addC" checked> Depot C</label>
  </div>
  <button class="button-add" onclick="addRow()">Hinzufügen</button>
  
</div>

<div id="updateContainer" class="update-container"></div>

<h2><span class="section-label">Depot A</span></h2>

<div class="flex-item">

<!-- <h2>Depot A</h2> -->
<table id="depotA"><tr><th>Name</th><th>Anzahl</th><th>Kurs (€)</th><th>Wert (€)</th><th>Aktion</th></tr></table>

<div class="cash-row">
<!--  <span class="cash-label cash-label--short">Cash</span> -->
  
  <span
  class="cash-label cash-label--short cash-button"
  onclick="openCashPopup('A')"
>
  Cash
</span>
  
<!-- NEU Mamu 27.01.2026 -->
 
<button
  type="button"
  id="cashA"
  class="cash-display"

></button>

<!--
 <input
    type="text"
    id="cashA"
    class="cash-input"   
    readonly
    onclick="openCashPopup('A')"
> 
-->
</div>

<div class="cash-row">
  <span class="cash-label cash-label--long">Gesamtwert</span>
  <input
   type="text"
   id="totalValueA"
   class="total-input"
   readonly
   
>
</div>
</div>

<h2><span class="section-label">Depot B</span></h2>

<div class="flex-item">
<!-- <h2>Depot B</h2> -->
<table id="depotB"><tr><th>Name</th><th>Anzahl</th><th>Kurs (€)</th><th>Wert (€)</th><th>Aktion</th></tr></table>

<div class="cash-row">
<!--  <span class="cash-label cash-label--short">Cash</span> -->
 
 <span
  class="cash-label cash-label--short cash-button"
  onclick="openCashPopup('B')"
>
  Cash
</span>
  
<!-- NEU Mamu 27.01.2026 -->
 
<button
  type="button"
  id="cashB"
  class="cash-display"

></button>
  
<!-- 
  <input
    type="text"
    id="cashB"
    class="cash-input"   
    readonly
    onclick="openCashPopup('B')"
> 
-->
</div>

<div class="cash-row">
  <span class="cash-label cash-label--long">Gesamtwert</span>
  <input
   type="text"
   id="totalValueB"
   class="total-input"
   readonly
>  
</div>
</div>

<h2><span class="section-label">Depot C</span></h2>

<div class="flex-item">
<!-- <h2>Depot C</h2> -->
<table id="depotC"><tr><th>Name</th><th>Anzahl</th><th>Kurs (€)</th><th>Wert (€)</th><th>Aktion</th></tr></table>

<div class="cash-row">
<!--  <span class="cash-label cash-label--short">Cash</span> -->

<span
  class="cash-label cash-label--short cash-button"
  onclick="openCashPopup('C')"
>
  Cash
</span>

<!-- NEU Mamu 27.01.2026 -->
 
<button
  type="button"
  id="cashC"
  class="cash-display"

></button>
  
<!--  
  <input
    type="text"
    id="cashC"
    class="cash-input"   
    readonly
    onclick="openCashPopup('C')"
> 
-->
</div>

<div class="cash-row">
  <span class="cash-label cash-label--long">Gesamtwert</span>
  <input
   type="text"
   id="totalValueC"
   class="total-input"
   readonly
>
</div>
</div>

<!--          Depot ABC Ende              -->

<h2><span class="section-label">Depot-Vergleich</span></h2>

<!-- <h2>Depot-Vergleich</h2> -->

<div class="section-label">
  Differenz (B − A): <span id="diffAB">0,00 €</span>
</div>



<div class="diff-bar">
  <div id="diffFillAB" class="diff-fill"></div>
</div>

<div class="section-label">
  Differenz (C - A): <span id="diffAC">0,00 €</span></div>
<div class="diff-bar">
  <div id="diffFillAC" class="diff-fill"></div>
</div>

<div class="section-label">
  Differenz (C - B): <span id="diffCB">0,00 €</span></div>
<div class="diff-bar">
  <div id="diffFillCB" class="diff-fill"></div>
</div>

<hr>
<button class="button-add" onclick="clearAll()">Alles löschen</button>

</div>

<div id="popup" class="popup">
  <div class="popup-content">
    <label id="popupLabel"></label>
    <input type="number" id="popupInput" step="0.01">
    <button id="popupConfirm">Bestätigen</button>
    <button onclick="closePopup()">Abbrechen</button>
  </div>
</div>

<script>

function formatNumber(num){ return Number(num).toLocaleString('de-DE',{minimumFractionDigits:2, maximumFractionDigits:2}); }

let depotA = JSON.parse(localStorage.getItem("depotA")||"[]");
let depotB = JSON.parse(localStorage.getItem("depotB")||"[]");
let depotC = JSON.parse(localStorage.getItem("depotC")||"[]");

function saveData(){
  localStorage.setItem("depotA", JSON.stringify(depotA));
  localStorage.setItem("depotB", JSON.stringify(depotB));
  localStorage.setItem("depotC", JSON.stringify(depotC));
  localStorage.setItem("cashA", document.getElementById("cashA").dataset.value);
  localStorage.setItem("cashB", document.getElementById("cashB").dataset.value);
  localStorage.setItem("cashC", document.getElementById("cashC").dataset.value);
}

function calcTotals(){
 
  console.log("calcTotals START");  
  
  function parseCash(id){ return parseFloat((document.getElementById(id).dataset.value||"0"))||0; }
  let totalA=parseCash("cashA"), totalB=parseCash("cashB"), totalC=parseCash("cashC");
  depotA.forEach(i=>totalA+=i.amount*i.price);
  depotB.forEach(i=>totalB+=i.amount*i.price);
  depotC.forEach(i=>totalC+=i.amount*i.price);




  let diffAB=totalB-totalA, diffAC=totalC-totalA, diffCB=totalC-totalB;

  document.getElementById("diffAB").innerText=formatNumber(diffAB)+" €";
  document.getElementById("diffAC").innerText=formatNumber(diffAC)+" €";
  document.getElementById("diffCB").innerText=formatNumber(diffCB)+" €";

  function setBar(diff,id,total1,total2){
    let bar=document.getElementById(id);
    let maxTotal=Math.max(total1,total2,1);
    let percent=(Math.abs(diff)/maxTotal)*(100/0.025);
    if(percent>100) percent=100;
    bar.style.width=percent+"%";

    if(diff>=0) bar.style.background= "linear-gradient(to right, #a0e6a0, #008000)";
    else bar.style.background= "linear-gradient(to right, #e68a8a, #b30000)";
    let pct= ((Math.abs(diff)/maxTotal)*100).toFixed(1);
    bar.innerText=pct+"%";
  }

  setBar(diffAB,"diffFillAB",totalA,totalB);
  setBar(diffAC,"diffFillAC",totalA,totalC);
  setBar(diffCB,"diffFillCB",totalB,totalC);
  
/* Dieser Block berechnet den Gesamtwert und zeigt ihn im Zahlenfeld an */  
  
  const totalInputA = document.getElementById("totalValueA");
if (totalInputA) {
  totalInputA.value = formatNumber(totalA);
}
console.log("totalValueA =", totalInputA ? totalInputA.value : "NICHT GEFUNDEN");

  const totalInputB = document.getElementById("totalValueB");
if (totalInputB) {
  totalInputB.value = formatNumber(totalB);
}
console.log("totalValueB =", totalInputB ? totalInputB.value : "NICHT GEFUNDEN");

  const totalInputC = document.getElementById("totalValueC");
if (totalInputC) {
  totalInputC.value = formatNumber(totalC);
}

console.log("totalValueC =", totalInputC ? totalInputC.value : "NICHT GEFUNDEN");

console.log("calcTotals END");
}

function renderTable(){
  function fillTable(dep,tableId){
    let table=document.getElementById(tableId);
    table.innerHTML="<tr><th>Name</th><th>Anzahl</th><th>Kurs (€)</th><th>Wert (€)</th><th>Aktion</th></tr>";
    dep.forEach((item,i)=>{
      let row=table.insertRow();
      let nameCell=row.insertCell(); nameCell.innerText=item.name; nameCell.className="name-cell";

      let amtCell=row.insertCell();
      let inputAmt=document.createElement("input");
      inputAmt.type="number"; inputAmt.step="1"; inputAmt.className="amount-input"; 
      inputAmt.value=item.amount;
      inputAmt.onclick=e=>{ openAmountPopup(item,dep); e.target.blur(); };
      amtCell.appendChild(inputAmt);

      let priceCell=row.insertCell();
      let inputPrice=document.createElement("input");
      inputPrice.type="number"; inputPrice.step="0.01"; inputPrice.className="price-input"; 
      inputPrice.onchange=e=>{item.price=parseFloat(e.target.value); saveData(); calcTotals(); renderTable();};
      inputPrice.value=item.price;
      priceCell.appendChild(inputPrice);

      let valueCell=row.insertCell(); valueCell.innerText=formatNumber(item.amount*item.price);

      let actionCell=row.insertCell();
      let delBtn=document.createElement("button"); delBtn.innerText="ENTF"; delBtn.className="button-del";
      delBtn.onclick=()=>{ showDeletePopup(item,dep); };
      actionCell.appendChild(delBtn);
    });
  }
  fillTable(depotA,"depotA");
  fillTable(depotB,"depotB");
  fillTable(depotC,"depotC");
  calcTotals();
}

let deleteItem=null, deleteDepot=null;
function showDeletePopup(item,depot){
  deleteItem=item; deleteDepot=depot;
  document.getElementById("popupLabel").innerText="Willst du diese Aktie wirklich löschen?";
  document.getElementById("popupInput").style.display="none";
  document.getElementById("popupConfirm").onclick=function(){
    if(deleteItem && deleteDepot){
      const index=deleteDepot.indexOf(deleteItem);
      if(index>-1){ deleteDepot.splice(index,1); saveData(); renderTable(); }
    }
    closePopup();
  };
  document.getElementById("popup").style.display="flex";
}

let amountItem=null, amountDepot=null;
function openAmountPopup(item,depot){
  amountItem=item; amountDepot=depot;
  document.getElementById("popupLabel").innerText="Anzahl für "+item.name;
  document.getElementById("popupInput").style.display="block";
  document.getElementById("popupInput").value="";
  document.getElementById("popupConfirm").onclick=function(){ 
    let val=parseFloat(document.getElementById("popupInput").value);
    if(!isNaN(val) && amountItem && amountDepot){
      amountItem.amount=val; saveData(); renderTable();
    }
    closePopup();
  };
  document.getElementById("popup").style.display="flex";
}

let cashDepot=null;
function openCashPopup(depot){
  cashDepot=depot;
  document.getElementById("popupLabel").innerText="Cash für Depot "+depot;
  document.getElementById("popupInput").style.display="block";
  document.getElementById("popupInput").value="";
  document.getElementById("popupConfirm").onclick=function(){
    let val=parseFloat(document.getElementById("popupInput").value);
    if(!isNaN(val)){
      document.getElementById("cash"+cashDepot).dataset.value=val;
      document.getElementById("cash"+cashDepot).innerText =formatNumber(val);
      saveData(); calcTotals();
    }
    closePopup();
  };
  document.getElementById("popup").style.display="flex";
}

function closePopup(){ document.getElementById("popup").style.display="none"; }

function toggleAdd(){
  const container=document.getElementById("addContainer");
  container.style.display=container.style.display==="flex"?"none":"flex";
}
function toggleUpdate(){
  const container=document.getElementById("updateContainer");
  container.innerHTML="";
  let allNames = [];
  [depotA,depotB,depotC].forEach(dep=>{dep.forEach(item=>{if(!allNames.includes(item.name)) allNames.push(item.name);});});
  allNames.forEach(name=>{
    let div=document.createElement("div"); div.className="update-row";
    let label=document.createElement("label"); label.innerText=name;
    let input=document.createElement("input");
	    input.type="number";
		input.className = "edit-input";      // NEU Mamu 2701
		input.step="0.01";
		input.value="";
    div.appendChild(label); div.appendChild(input);
    container.appendChild(div);
  });
  let btn=document.createElement("button"); btn.className="button-update"; btn.innerText="Aktualisieren";
  btn.onclick=()=>{
    let rows=container.querySelectorAll(".update-row");
    rows.forEach((row,i)=>{
      let val=parseFloat(row.querySelector("input").value);
      if(!isNaN(val)){
        [depotA,depotB,depotC].forEach(dep=>{if(dep[i]) dep[i].price=val;});
      }
    });
    saveData(); renderTable(); toggleUpdate();
  };
  container.appendChild(btn);
  container.style.display=container.style.display==="flex"?"none":"flex";
}

function addRow(){
  let name=document.getElementById("newName").value;
  let amount=parseFloat(document.getElementById("newAmount").value);
  let price=parseFloat(document.getElementById("newPrice").value);
  if(!name||isNaN(amount)||isNaN(price)) return;
  if(document.getElementById("addA").checked) depotA.push({name,amount,price});
  if(document.getElementById("addB").checked) depotB.push({name,amount,price});
  if(document.getElementById("addC").checked) depotC.push({name,amount,price});
  saveData(); renderTable();
  document.getElementById("newName").value="";
  document.getElementById("newAmount").value="";
  document.getElementById("newPrice").value="";
  toggleAdd();
}

function clearAll(){
  if(confirm("Alle Daten löschen?")){
    depotA=[]; depotB=[]; depotC=[];
    ["cashA","cashB","cashC"].forEach(id=>{document.getElementById(id).dataset.value="0"; document.getElementById(id).value=formatNumber(0);});
    saveData(); renderTable();
  }
}

["A","B","C"].forEach(d=>{
  let val=parseFloat(localStorage.getItem("cash"+d)||"0");
  let el=document.getElementById("cash"+d);
  el.dataset.value=val;
  el.innerText=formatNumber(val);
});


document.getElementById("cover").onclick = function () {

  document.body.classList.add("cover-open");
  document.body.classList.remove("page-open");

  const cover = document.getElementById("cover");
  const container = document.querySelector(".container");

  cover.style.transform = "scale(0.85)";
  cover.style.opacity = "0";

  setTimeout(() => {
    cover.style.display = "none";

    document.body.classList.remove("cover-open");
    document.body.classList.add("page-open");

    container.style.display = "block";
    container.style.opacity = "0";

    requestAnimationFrame(() => {
      container.classList.add("open");
      container.style.opacity = "1";
    });

    renderTable();
  }, 600);
};


document.getElementById("closeBook").addEventListener("click", function () {

  const container = document.querySelector(".container");
  const cover = document.getElementById("cover");

  container.classList.remove("open");
  container.style.opacity = "0";

  setTimeout(() => {
    container.style.display = "none";

    cover.style.display = "block";
    requestAnimationFrame(() => {
      cover.style.transform = "scale(1)";
      cover.style.opacity = "1";
    });

    document.body.classList.remove("page-open");
    document.body.classList.add("cover-open");
  }, 500);
});


</script>
</body>
</html>
